{% extends "base.html" %}
{% block title %}Invoice / Receipt{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-3">Order #{{ order.id }} - Invoice / Receipt</h2>

  <!-- Payment form (manual fill) -->
  <form method="post" class="card mb-4">
    <div class="card-body row g-3">
      <div class="col-md-3">
        <label class="form-label">Unit price (per item)</label>
        <input type="number" step="0.01" name="unit_price"
               class="form-control" value="{{ unit_price }}">
      </div>
      <div class="col-md-3">
        <label class="form-label">Qty</label>
        <input type="number" class="form-control" value="{{ qty }}" disabled>
      </div>
      <div class="col-md-3">
        <label class="form-label">Amount paid</label>
        <input type="number" step="0.01" name="amount_paid"
               class="form-control" value="{{ amount_paid }}">
      </div>
      <div class="col-md-3">
        <label class="form-label">Payment type</label>
        <select name="payment_mode" class="form-select">
          <option value="order_only" {{ 'selected' if payment_mode == 'order_only' }}>
            Order Only
          </option>
          <option value="cod" {{ 'selected' if payment_mode == 'cod' }}>
            COD (လက်ငင်းပေး)
          </option>
          <option value="deposit" {{ 'selected' if payment_mode == 'deposit' }}>
            စရံသာ (Deposit)
          </option>
          <option value="full_paid" {{ 'selected' if payment_mode == 'full_paid' }}>
            ငွေအပြည့် (Full Paid)
          </option>
        </select>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary">
          Preview Invoice / Receipt
        </button>
        <a href="{{ url_for('admin_orders') }}" class="btn btn-secondary ms-2">
          Back to orders
        </a>
      </div>
    </div>
  </form>

  <!-- Invoice / Receipt preview -->
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h4 class="mb-0">
            {% if is_paid %}RECEIPT{% else %}INVOICE{% endif %}
          </h4>
          <small class="text-muted">Order No: {{ order.id }}</small><br>
          <small class="text-muted">Date: {{ order.created_at }}</small>
        </div>
        <div class="text-end">
          <div class="fw-bold">MGL Blanket / MGL Fashion</div>
          <small class="text-muted">Admin Panel</small>
        </div>
      </div>

      <hr>

      <div class="row mb-3">
        <div class="col-md-6">
          <h6>Customer</h6>
          <p class="mb-0">{{ order.customer_name }}</p>
          <p class="mb-0">{{ order.phone }}</p>
          <p class="mb-0">{{ order.city }}</p>
          <p class="mb-0">{{ order.address }}</p>
        </div>
        <div class="col-md-6">
          <h6>Payment Info</h6>
          <p class="mb-0">
            Payment type:
            {% if payment_mode == 'cod' %}
              COD
            {% elif payment_mode == 'deposit' %}
              Deposit
            {% elif payment_mode == 'full_paid' %}
              Full Paid
            {% else %}
              Order Only
            {% endif %}
          </p>
          <p class="mb-0">
            Amount paid: {{ "{:,.0f}".format(amount_paid) }} Ks
          </p>
        </div>
      </div>

      <table class="table table-sm table-bordered mb-3">
        <thead class="table-light">
          <tr>
            <th>Item</th>
            <th class="text-end">Qty</th>
            <th class="text-end">Unit price</th>
            <th class="text-end">Total</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              {% if product %}
                {{ product.name_mm }} / {{ product.name_en }}
              {% else %}
                Product ID: {{ order.product_id }}
              {% endif %}
            </td>
            <td class="text-end">{{ qty }}</td>
            <td class="text-end">
              {{ "{:,.0f}".format(unit_price) }} Ks
            </td>
            <td class="text-end">
              {{ "{:,.0f}".format(total_amount) }} Ks
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <th colspan="3" class="text-end">Total</th>
            <th class="text-end">
              {{ "{:,.0f}".format(total_amount) }} Ks
            </th>
          </tr>
          <tr>
            <th colspan="3" class="text-end">Amount paid</th>
            <th class="text-end">
              {{ "{:,.0f}".format(amount_paid) }} Ks
            </th>
          </tr>
          <tr>
            <th colspan="3" class="text-end">Balance</th>
            <th class="text-end">
              {{ "{:,.0f}".format(balance if balance > 0 else 0) }} Ks
            </th>
          </tr>
        </tfoot>
      </table>

      {% if is_paid %}
        <div class="text-end">
          <span class="badge bg-success fs-5 px-3 py-2">PAID</span>
        </div>
      {% else %}
        <div class="text-end">
          <span class="badge bg-warning text-dark fs-6 px-3 py-2">Amount Due</span>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
